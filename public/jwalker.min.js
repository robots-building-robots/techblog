(()=>{(function(){let M=[[1,0],[-1,0],[0,1],[0,-1]],S=8,w=.02;function m(l){let t=document.createElement("canvas").getContext("2d");t.fillStyle=l;let s=t.fillStyle;if(s[0]==="#"){let i=parseInt(s.slice(1),16);return[i>>16&255,i>>8&255,i&255]}return s.match(/\d+/g).slice(0,3).map(Number)}class y{constructor(t,{x:s,y:i,lead:a,tail:n,size:o,speed:e,length:c}){this.canvas=t,this.lead=m(a),this.tail=m(n),this.size=o,this.length=c,this.stopped=!1,this.opacity=0,this.col=Math.floor(s/o),this.row=Math.floor(i/o),this.trail=[{col:this.col,row:this.row}],this.occupied=new Set([this.col*1e4+this.row]),this._elapsed=0,this._interval=1e3/e}step(){let t=M;for(let n=3;n>0;n--){let o=Math.random()*(n+1)|0,e=t[n];t[n]=t[o],t[o]=e}let s=this.size,i=this.canvas.width/s|0,a=this.canvas.height/s|0;for(let n=0;n<4;n++){let o=this.col+t[n][0],e=this.row+t[n][1];if(o<0||e<0||o>=i||e>=a)continue;let c=o*1e4+e;if(!this.occupied.has(c)){if(this.col=o,this.row=e,this.trail.push({col:o,row:e}),this.occupied.add(c),this.trail.length>this.length){let d=this.trail.shift();this.occupied.delete(d.col*1e4+d.row)}return!0}}return!1}update(t){if(this.stopped){this.opacity=this.opacity-w<0?0:this.opacity-w;return}for(this.opacity=this.opacity+w>1?1:this.opacity+w,this._elapsed+=t;this._elapsed>=this._interval;)if(this._elapsed-=this._interval,!this.step()){this.stopped=!0;return}}get alive(){return this.opacity>.01}draw(t){let s=this.trail.length,i=this.opacity,a=this.size,[n,o,e]=this.lead,[c,d,f]=this.tail;for(let p=0;p<s;p++){let r=(p+1)/s,g=(n-c)*r+c|0,u=(o-d)*r+d|0,h=(e-f)*r+f|0;t.fillStyle=`rgba(${g},${u},${h},${r*i})`;let z=this.trail[p];t.fillRect(z.col*a+1,z.row*a+1,a-1,a-1)}}}function v(l,t){return new y(l,{x:Math.random()*l.width,y:Math.random()*l.height,lead:t.lead,tail:t.tail,size:t.size,speed:t.speed,length:t.length})}document.querySelectorAll(".jwalker").forEach(function(l){getComputedStyle(l).position==="static"&&(l.style.position="relative"),l.style.isolation="isolate";let t=l.dataset,s={lead:t.color||"#a0a0a0",tail:t.colorEnd||"#000000",size:t.size?parseInt(t.size,10):S,count:t.count?parseInt(t.count,10):null,speed:t.speed?parseFloat(t.speed):4+Math.random()*8,length:t.length?parseInt(t.length,10):20+Math.floor(Math.random()*40)},i=document.createElement("canvas");i.setAttribute("aria-hidden","true"),i.style.cssText="position:fixed;inset:0;width:100%;height:100%;z-index:-1;",l.prepend(i);let a=i.getContext("2d"),n=8,o=0,e=[],c=!0,d=null;new ResizeObserver(function(){clearTimeout(d),d=setTimeout(function(){c=!0},150)}).observe(l),l.addEventListener("click",function(r){let g=l.getBoundingClientRect(),u=new y(i,{x:r.clientX-g.left,y:r.clientY-g.top,lead:s.lead,tail:s.tail,size:s.size,speed:s.speed,length:s.length});u.opacity=1,e.length>=n&&e.shift(),e.push(u)});let f=null;function p(r){let g=f===null?0:r-f;if(f=r,c){c=!1;let h=s.count??3;o=window.innerWidth<768?Math.ceil(h/2):h,i.width=window.innerWidth,i.height=window.innerHeight,e=Array.from({length:o},function(){return v(i,s)})}let u=0;for(let h=0;h<e.length;h++)e[h].alive&&(e[u++]=e[h]);for(e.length=u;e.length<o;)e.push(v(i,s));e.length>n&&e.splice(0,e.length-n),a.clearRect(0,0,i.width,i.height);for(let h=0;h<e.length;h++)e[h].update(g),e[h].draw(a);requestAnimationFrame(p)}requestAnimationFrame(p)})})();})();
